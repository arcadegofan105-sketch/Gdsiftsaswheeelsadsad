generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"  // ← было "sqlite"
  url      = env("DATABASE_URL")
}


model User {
  id          String   @id @default(cuid())
  telegramId  String   @unique
  username    String?
  firstName   String?
  lastName    String?
  balance     Float    @default(5.0)
  tonWallet   String?
  depositMemo String?  @unique
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  transactions Transaction[]
  deposits     Deposit[]
  withdraws    WithdrawRequest[]
  inventory    InventoryItem[]
  promoUses    PromoRedemption[]
  games        Game[]
}

model Transaction {
  id     String  @id @default(cuid())
  userId String
  user   User    @relation(fields: [userId], references: [id])
  
  type        String // "deposit", "withdraw", "spin", "crash_bet", "crash_win", "prize_sell"
  amount      Float
  description String?
  
  createdAt DateTime @default(now())
}

model Deposit {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  depositId   String   @unique
  address     String
  amount      Float
  txHash      String?
  fromAddress String?
  comment     String?
  status      String   @default("pending")
  
  createdAt   DateTime @default(now())
}



model WithdrawRequest {
  id     String  @id @default(cuid())
  userId String
  user   User    @relation(fields: [userId], references: [id])
  
  type      String  // "ton" або "gift"
  amount    Float?  // для TON
  giftName  String? // для подарка
  toAddress String? // адрес для вывода TON
  
  status String @default("pending") // "pending", "approved", "rejected"
  
  createdAt  DateTime  @default(now())
  approvedAt DateTime?
  txHash     String? // хэш транзакции после вывода
}

model InventoryItem {
  id     String  @id @default(cuid())
  userId String
  user   User    @relation(fields: [userId], references: [id])
  
  name  String
  emoji String
  price Float
  
  createdAt DateTime @default(now())
}

model PromoRedemption {
  id     String  @id @default(cuid())
  userId String
  user   User    @relation(fields: [userId], references: [id])
  
  code   String
  amount Float
  
  createdAt DateTime @default(now())
  
  @@unique([userId, code])
}

model Game {
  id     String  @id @default(cuid())
  userId String
  user   User    @relation(fields: [userId], references: [id])
  
  type       String  // "wheel" или "crash"
  bet        Float
  result     Float   // выигрыш или 0
  multiplier Float?  // для краша
  prize      String? // для колеса (JSON или название)
  
  createdAt DateTime @default(now())
}

// Выводы TON
model Withdrawal {
  id     Int     @id @default(autoincrement())
  userId String
  
  address String // Адрес для вывода
  amount  Float
  status  String @default("pending") // pending, processing, completed, failed
  txHash  String? // Хеш транзакции
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  processedAt DateTime? // Когда обработан
}



